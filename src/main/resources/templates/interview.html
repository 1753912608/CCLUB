<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CCLUB视频面试</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://cdn.bootcss.com/vue/2.6.8/vue.min.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
    <script type="text/javascript" src="../js/ckplayer/ckplayer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>
    <style>
        .el-a-style{
            text-decoration:none;
            font-size:14px;
            color:#8b8f94;
        }
        .img:hover{
            width:45px;
            height:45px;
        }
        .message{
            background-color: white;
            border-bottom-color: white;
            /*为了给after伪元素自动继承*/
            font-size: 12px;
            line-height: 18px;
            padding: 5px 12px 5px 12px;
            box-sizing: border-box;
            border-radius: 6px;
            position: relative;
            word-break: break-all;
        }
        /** 通过对小正方形旋转45度解决 **/
        .message::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -5px;
            width: 10px;
            height: 10px;
            margin-top: -10px;
            background: inherit;
            /*自动继承父元素的背景*/
            transform: rotate(45deg);
        }

    </style>
</head>
<body>
<div style="float:left;margin-left:150px;margin-top:90px;">
    <div style="width:960px;height:580px;margin-top:-20px;">
        <!--代码输入框（注意请务必设置高度，否则无法显示）-->
        <pre id="code" class="ace_editor" style="min-height:580px">
            <textarea class="ace_text-input" style="background-color:rgb(200,200,200)" id="codeText">
//在下方编辑代码
            </textarea>
        </pre>
    </div>
</div>
<div id="app">
    <div style="width:100%;height:40px;">
        <div style="padding-top:10px;">
            <span style="font-size:24px;margin-left:-1100px;">{{name}}</span>
            <span style="margin-left:1100px;"><a href="javascript:void(0);" class="el-a-style">设备检测</a></span>
            <span style="margin-left:30px;"><a href="javascript:void(0);" class="el-a-style">帮助中心</a></span>
        </div>
    </div>
    <el-divider></el-divider>
    <div>
        <div style="float:left;">
            <div style="">
                <div id="video1" style="width:280px;height:180px"></div>
            </div>
            <div style="width:280px;height:350px;background-color:rgb(240,240,240);" id="chatContent">
                <div class="panel-body" style="overflow:scroll;width:280px;height:350px;">
                    <div style="border: 1px  #000000; width: 90%; margin: 0 auto;">
                        <div  style="padding-top:5px;" v-if="chatContent.length>0">
                            <div style="float:left;">
                                <div style="font-size:12px;color:rgb(100,100,100)" v-if="chatContent[0].from_user==='candidate'">候选人</div>
                                <div style="font-size:12px;color:rgb(100,100,100)" v-if="chatContent[0].from_user==='judge'">面试官</div>
                                <div><img src="../img/headChat.png" alt="" width="30px" height="30px"></div>
                            </div>
                            <div class="message" style="width:160px;float:left;margin-left:15px;margin-top:5px;" :style="{'color':(chatContent[0].from_user==='judge' ? 'red':'cornflowerblue')}">
                                {{chatContent[0].chat_content}}
                            </div>
                        </div>
                        <div v-for="(item,index) in chatContent" :style="{'padding-top':length[index-1]+'px'}" v-if="index > 0">
                            <div style="float:left;">
                                <div style="font-size:12px;color:rgb(100,100,100)" v-if="chatContent[index].from_user==='candidate'">候选人</div>
                                <div style="font-size:12px;color:rgb(100,100,100)" v-if="chatContent[index].from_user==='judge'">面试官</div>
                                <div><img src="../img/headChat.png" alt="" width="30px" height="30px"></div>
                            </div>
                            <div class="message" style="width:160px;float:left;margin-left:15px;margin-top:5px;" :style="{'color':(chatContent[index].from_user==='judge' ? 'red':'cornflowerblue')}">
                                {{item.chat_content}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="width:280px;height:50px;background-color:rgb(60,60,60)">
                <div style="float:left;">
                    <el-input v-model="input" placeholder="请输入内容" style="width:210px;padding-top:5px;">
                    </el-input>
                </div>
                <div style="float:left;margin-top:5px;"><el-button type="primary" @click="sendChatContent">发送</el-button></div>
            </div>
        </div>
    </div>
    <div style="margin-top:630px;margin-left:160px;">
        <div style="float:left;">
            <el-tooltip class="item" effect="dark" content="候选人信息" placement="top-start" slot="reference" v-if="interviewInfo.interview_create_user_id==='judge'">
                <a href="javascript:void(0);" @click="openCandidateInfo">
                    <img src="../img/candidate_info.png" alt="" width="30px" height="30px">
                </a>
            </el-tooltip>
        </div>
        <div style="float:left;margin-left:15px;">
            <el-tooltip class="item" effect="dark" content="添加面试评价" placement="top-start" v-if="interviewInfo.interview_create_user_id==='judge'">
                <a href="javascript:void(0);" @click="dialogVisible_remarks_interview=true">
                    <img src="../img/edit.png" alt="" width="30px" height="30px">
                </a>
            </el-tooltip>
        </div>
        <div style="float:left;margin-left:400px;">
            <a href="javascript:void(0);" @click="changeVolume">
                <img :src="volumeImg" alt="" width="40px" height="40px" class="img">
            </a>
        </div>
        <div style="float:left;margin-left:15px;">
            <a href="javascript:void(0);" @click="changeVedio">
                <img :src="vedioImg" alt="" width="40px" height="40px" class="img">
            </a>
        </div>
        <div style="float:left;margin-left:15px;">
            <a href="javascript:void(0);">
                <img src="../img/break.png" alt="" width="40px" height="40px" class="img">
            </a>
        </div>
    </div>
    <!--备注面试-->
    <el-dialog title="面试反馈" :visible.sync="dialogVisible_remarks_interview" width="30%" before-close="handleClose">
        <el-form  label-width="0px">
            <el-form-item style="margin-top:-20px;">
                <p>结果</p>
                <p style="font-size:13px;color:#8b8f94;margin-top:-30px;">请给出候选人的面试结果</p>
            </el-form-item>
            <el-form-item style="margin-top:-45px;">
                <template>
                    <el-radio v-model="remarks.radio" label="1">通过</el-radio>
                    <el-radio v-model="remarks.radio" label="2">拒绝</el-radio>
                    <el-radio v-model="remarks.radio" label="3">待定</el-radio>
                </template>
            </el-form-item>
            <el-form-item style="margin-top:-25px;">
                <p>综合评价</p>
                <p style="font-size:13px;color:#8b8f94;margin-top:-30px;">请详细说明候选人的优势、不足及任何值得注意的方面</p>
            </el-form-item>
            <el-form-item style="margin-top:-30px;">
                <el-input type="textarea" :rows="4" placeholder="请输入内容" v-model="remarks.textarea">
                </el-input>
            </el-form-item>
        </el-form>
        <span slot="footer" class="dialog-footer">
            <el-button @click="dialogVisible_remarks_interview = false">取 消</el-button>
            <el-button type="primary" @click="">确 定</el-button>
        </span>
    </el-dialog>
</div>
</body>
<script>
    //初始化对象
    editor = ace.edit("code");

    //设置风格和语言（更多风格和语言，请到github上相应目录查看）
    theme = "clouds"
    language = "java"
    editor.setTheme("ace/theme/" + theme);
    editor.session.setMode("ace/mode/" + language);

    //字体大小
    editor.setFontSize(18);

    //设置只读（true时只读，用于展示代码）
    editor.setReadOnly(false);

    //自动换行,设置为off关闭
    editor.setOption("wrap", "free")

    //启用提示菜单
    ace.require("ace/ext/language_tools");
    editor.setOptions({
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: true
    });
</script>
<script>
    new Vue({
        el :'#app',
        data:{
            name: 'CCLUB 视频面试',
            input: '',
            interviewInfo: {},
            dialogVisible_remarks_interview: false,
            remarks:{
                radio: '',
                textarea: ''
            },
            volumeImg: '../img/volume_open.png',
            vedioImg: '../img/vedio_open.png',
            chatContent:[],
            length:[],
            websocket: null,
            chat:{
                interview_id: '',
                type: '',
                chat_content: '',
                from_user: ''
            }
        },
        created() {
            this.init();
            this.getOneInterviewInfo();
        },
        methods: {
            async init() {
                var vedioObject1={
                    container: '#video1',
                    variable: 'player',
                    autoplay: true,
                    live: true,
                    video: 'rtmp://127.0.0.1:1935/live/home1'
                }
                var player1=new ckplayer(vedioObject1);
            },
            openCandidateInfo(){
                this.candidateInfo='';
                this.getCandidateInfo();
                this.$notify({
                    title: '候选人信息',
                    message: this.candidateInfo,
                    duration: 0,
                    position: 'bottom-left',
                    dangerouslyUseHTMLString: true
                });
            },
            getCandidateInfo(){
                this.candidateInfo+=('面试时间'+'&nbsp;&nbsp;&nbsp;'+this.interviewInfo.interview_begin_time+'</br>');
                this.candidateInfo+=('公司'+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+this.interviewInfo.interview_company_name+'</br>');
                this.candidateInfo+=('应聘职位'+'&nbsp;&nbsp;&nbsp;'+this.interviewInfo.interview_candidate_position+'</br>');
                this.candidateInfo+=('候选人'+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+this.interviewInfo.interview_candidate_name+'</br>');
                this.candidateInfo+=('手机号'+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+this.interviewInfo.interview_candidate_phone+'</br>');
                this.candidateInfo+=('邮箱'+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+this.interviewInfo.interview_candidate_mail+'</br>');
            },
            setInterviewRemarks(){

            },
            changeVolume(){
                if(this.volumeImg==='../img/volume_open.png'){
                    this.volumeImg='../img/volume_close.png';
                }else{
                    this.volumeImg='../img/volume_open.png';
                }
            },
            changeVedio(){
                if(this.vedioImg==='../img/vedio_open.png'){
                    this.vedioImg='../img/vedio_close.png';
                }else{
                    this.vedioImg='../img/vedio_open.png';
                }
            },
            breakInterview(){

            },
            sendChatContent(){
                this.websocketSendChat();
            },
            async getOneInterviewInfo(){
                let result=await axios.get('/getOneInterviewInfo');
                this.interviewInfo=result.data;
                console.log(this.interviewInfo);
                this.websocket=new WebSocket("ws://localhost:8080/test/one/"+this.interviewInfo.interview_id);
                this.websocket.onmessage=this.getMessage;
                this.chat.interview_id=this.interviewInfo.interview_id;
                this.chat.from_user=this.interviewInfo.interview_create_user_id;
            },
            getMessage(msg){
                let obj=new Object();
                let json=JSON.parse(msg.data);
                obj.chat_content=json.chat_content;
                obj.from_user=json.from_user;
                obj.type=json.type;
                this.chatContent.push(obj);
                this.input='';
                if(this.chatContent.length>1){
                    console.log(this.chatContent[this.length.length].chat_content.length);
                    this.length.push((this.chatContent[this.length.length].chat_content.length/15)*10+50)
                }
            },
            websocketSendChat(){
                this.chat.chat_content=this.input;
                this.chat.from_user=this.interviewInfo.interview_create_user_id
                this.chat.type='chat';
                this.websocket.send(JSON.stringify(this.chat));
            },
            websocketSendCode(){
                this.chat.chat_content='';
                this.chat.type='code';
                this.websocket.send(JSON.stringify(this.chat));
            }
        }
    })
</script>
</html>